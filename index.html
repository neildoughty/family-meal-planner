<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Family Meal Planner</title>
  <style>
    /* Base resets */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      padding: 20px;
      background: #f0f0f5;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-weight: 400;
      color: #333;
    }

    /* Admin: add meals */
    .meal-admin {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      gap: 8px;
    }
    .meal-admin input {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      flex: 1;
      font-size: 1rem;
    }
    .meal-admin button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      background: #007aff;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .meal-admin button:hover { background: #005fcc; }

    /* Layout: 2-column desktop, single-column mobile */
    .layout { display: grid; grid-template-columns: 3fr 2fr; gap: 20px; }
    @media (max-width: 768px) { .layout { grid-template-columns: 1fr; } }

    /* Days grid */
    .days { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; }
    @media (min-width: 769px) { .days { grid-template-columns: repeat(5, minmax(160px, 1fr)); } }
    .day-card {
      background: #ffffff;
      border-radius: 12px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .day-card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    }
    .day-card h2 {
      font-size: 1.1rem;
      font-weight: 500;
      margin-bottom: 8px;
      color: #111;
    }
    .selected-meal {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: #555;
      min-height: 1.2em;
    }
    .day-card select {
      width: 100%;
      margin-top: 6px;
      font-size: 0.95rem;
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    /* History table styling */
    .history-table {
      width: 100%;
      border-collapse: collapse;
      background: #ffffff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      table-layout: fixed;
    }
    .history-table th,
    .history-table td {
      border-bottom: 1px solid #e0e0e5;
      padding: 8px 12px;
      text-align: left;
      font-size: 0.9rem;
      color: #333;
    }
    .history-table th {
      background: #fafafa;
      font-weight: 500;
      color: #666;
    }
    .history-table tr:last-child td { border-bottom: none; }
    @media (max-width: 768px) { .history-table { margin-top: 20px; } }
  </style>
</head>
<body>
  <h1>Family Meal Planner</h1>

  <div class="meal-admin">
    <input type="text" id="new-meal-input" placeholder='Add new meal (e.g. "Spaghetti Bolognese")' />
    <button id="add-meal-button">Add Meal</button>
  </div>

  <div class="layout">
    <!-- Meal selection cards -->
    <div class="days">
      <div class="day-card"><h2>Monday</h2><div class="selected-meal"></div><select></select></div>
      <div class="day-card"><h2>Tuesday</h2><div class="selected-meal"></div><select></select></div>
      <div class="day-card"><h2>Wednesday</h2><div class="selected-meal"></div><select></select></div>
      <div class="day-card"><h2>Thursday</h2><div class="selected-meal"></div><select></select></div>
      <div class="day-card"><h2>Friday</h2><div class="selected-meal"></div><select></select></div>
      <div class="day-card"><h2>Saturday</h2><div class="selected-meal"></div><select></select></div>
      <div class="day-card"><h2>Sunday</h2><div class="selected-meal"></div><select></select></div>
    </div>

    <!-- Meal history table -->
    <table class="history-table">
      <thead>
        <tr><th>Meal</th><th>Days Since Last Eaten</th><th>Times Eaten (6w)</th></tr>
      </thead>
      <tbody id="history-body">
        <!-- Filled by JS -->
      </tbody>
    </table>
  </div>

  <script>
    // Initial meal list
    const defaultMeals = [
      "Burgers","Carbonara","Chicken Shwarama","Chicken Tikka",
      "Chilli","Fajitas","Fish and chips","Mackerel pasta",
      "Meatball pasta","Pasta Amatriciana","Pizzas","Pork and potatoes",
      "Sausage and chips","Thai Curry","Toad in the hole","Tuna and Sweetcorn pasta"
    ];
    let meals = JSON.parse(localStorage.getItem('meals')) || defaultMeals.slice();
    let selections = JSON.parse(localStorage.getItem('selections')) || {};
    let history = JSON.parse(localStorage.getItem('history')) || [];
    meals.sort();

    // Save helpers
    function saveMeals() { localStorage.setItem('meals', JSON.stringify(meals)); }
    function saveSelections() { localStorage.setItem('selections', JSON.stringify(selections)); }
    function saveHistory() { localStorage.setItem('history', JSON.stringify(history)); }

    // Populate dropdowns and headings
    function populateDropdowns() {
      document.querySelectorAll('.day-card').forEach(card => {
        const day = card.querySelector('h2').textContent;
        const select = card.querySelector('select');
        select.innerHTML = '<option value="">— pick a meal —</option>';
        meals.forEach(meal => {
          const opt = document.createElement('option'); opt.value = meal; opt.textContent = meal;
          select.appendChild(opt);
        });
        if (selections[day]) select.value = selections[day];
        updateSelectedHeading(select);
      });
    }

    // Update small heading
    function updateSelectedHeading(select) {
      const card = select.closest('.day-card');
      card.querySelector('.selected-meal').textContent = select.value || '';
    }

    // Record history event
    function recordHistory(meal) {
      if (!meal) return;
      const today = new Date().toISOString().split('T')[0];
      history.push({ meal, date: today });
      saveHistory();
    }

    // Compute days difference
    function daysBetween(dateStr) {
      const today = new Date();
      const then = new Date(dateStr);
      return Math.floor((today - then) / (1000*60*60*24));
    }

    // Render history table
    function renderHistoryTable() {
      const tbody = document.getElementById('history-body');
      tbody.innerHTML = '';
      const today = new Date();
      meals.forEach(meal => {
        // filter history
        const entries = history.filter(e => e.meal === meal);
        // days since last
        const lastDate = entries.length ? entries[entries.length-1].date : null;
        const daysSince = lastDate ? daysBetween(lastDate) : '-';
        // count in past 42 days
        const countRecent = entries.filter(e => {
          return daysBetween(e.date) <= 42;
        }).length;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${meal}</td><td>${daysSince}</td><td>${countRecent}</td>`;
        tbody.appendChild(tr);
      });
    }

    // Initialize
    function init() {
      // Add meal
      document.getElementById('add-meal-button').addEventListener('click', () => {
        const input = document.getElementById('new-meal-input');
        const newMeal = input.value.trim();
        if (newMeal && !meals.includes(newMeal)) {
          meals.push(newMeal); meals.sort(); saveMeals(); renderHistoryTable();
          populateDropdowns(); input.value = '';
        }
      });
      // Populate
      populateDropdowns();
      renderHistoryTable();
      // Selection changes
      document.querySelectorAll('.day-card select').forEach(select => {
        select.addEventListener('change', () => {
          const day = select.closest('.day-card').querySelector('h2').textContent;
          const meal = select.value;
          selections[day] = meal;
          saveSelections();
          updateSelectedHeading(select);
          recordHistory(meal);
          renderHistoryTable();
        });
      });
    }
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
